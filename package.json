{
  "name": "midas",
  "displayName": "midas",
  "icon": "docs/index.png",
  "description": "Midas: A GDB/MI Visual Studio Code Debug Adapter",
  "keywords": [
    "gdb",
    "midas",
    "debug"
  ],
  "version": "0.8.1",
  "engines": {
    "vscode": "^1.74.0"
  },
  "categories": [
    "Debuggers"
  ],
  "activationEvents": [
    "onStartupFinished",
    "onDebug",
    "onCommand:midas.issue-report",
    "onCommand:midas.get-rr"
  ],
  "main": "./extension.js",
  "publisher": "farrese",
  "repository": {
    "type": "git",
    "url": "https://github.com/farre/midas"
  },
  "contributes": {
    "configuration": [
      {
        "title": "Midas toolchains",
        "properties": {
          "midas.rr": {
            "type": "string",
            "default": null,
            "description": "Path to RR. This setting is not required, as Midas will look for RR in $PATH if not set."
          },
          "midas.gdb": {
            "type": "string",
            "default": null,
            "description": "Path to GDB. This setting is not required, as Midas will look for GDB in $PATH if not set."
          }
        }
      }
    ],
    "views": {
      "debug": [
        {
          "type": "webview",
          "id": "midas.checkpoints-ui",
          "name": "Checkpoints",
          "contextualTitle": "RR Checkpoints",
          "when": "midas.rrSession == true"
        }
      ]
    },
    "breakpoints": [
      {
        "language": "c"
      },
      {
        "language": "cpp"
      },
      {
        "language": "rust"
      }
    ],
    "commands": [
      {
        "command": "midas.issue-report",
        "title": "Midas: Create github issue log",
        "shortTitle": "Midas: Create github issue log"
      },
      {
        "command": "midas.rr-record",
        "title": "Record the execution of a binary",
        "shortTitle": "rr Record"
      },
      {
        "command": "midas.session-continue-all",
        "title": "Continue all threads",
        "shortTitle": "Continue All",
        "icon": "$(debug-continue)",
        "enablement": "midas.allStopModeSet == false && midas.debugType == midas-gdb && midas.Running == false"
      },
      {
        "command": "midas.session-pause-all",
        "title": "Pause all threads",
        "shortTitle": "Pause all",
        "icon": "$(debug-pause)",
        "enablement": "midas.allStopModeSet == false && midas.debugType == midas-gdb && midas.Running == true"
      },
      {
        "command": "midas.reverse-finish",
        "title": "Reverse finish",
        "shortTitle": "Reverse finish",
        "icon": "$(debug-step-out)",
        "enablement": "midas.rrSession == true && midas.debugType == midas-rr && midas.Running == false"
      },
      {
        "command": "midas.hot-reload-scripts",
        "title": "Re-initializes Midas",
        "shortTitle": "Re-initialize"
      },
      {
        "command": "midas.show-logs",
        "title": "Midas: Open logs",
        "shortTitle": "Midas: Open logs"
      },
      {
        "command": "midas.get-rr",
        "title": "Midas: Get rr",
        "shortTitle": "Get rr"
      },
      {
        "command": "midas.clear-checkpoints",
        "category": "Midas Checkpoints",
        "title": "Clear checkpoints"
      },
      {
        "command": "midas.set-checkpoint",
        "category": "Midas Checkpoints",
        "title": "Set Checkpoint",
        "icon": "$(device-camera)"
      }
    ],
    "menus": {
      "view/item/context": [
        {
          "command": "midas.clear-checkpoints",
          "when": "view == midas.checkpoints-ui"
        }
      ],
      "view/title": [
        {
          "command": "midas.clear-checkpoints",
          "group": "midas",
          "when": "view == midas.checkpoints-ui"
        }
      ],
      "debug/toolBar": [
        {
          "command": "midas.session-continue-all",
          "group": "midas",
          "when": "midas.allStopModeSet == false && midas.debugType == midas-gdb"
        },
        {
          "command": "midas.session-pause-all",
          "group": "midas",
          "when": "midas.allStopModeSet == false && midas.debugType == midas-gdb"
        },
        {
          "command": "midas.reverse-finish",
          "group": "midas",
          "when": "midas.rrSession == true && midas.debugType == midas-rr"
        },
        {
          "command": "midas.set-checkpoint",
          "group": "midas",
          "when": "midas.rrSession == true && midas.debugType == midas-rr"
        }
      ]
    },
    "debuggers": [
      {
        "type": "midas-gdb",
        "label": "C/C++ Midas GDB",
        "languages": [
          "c",
          "cpp",
          "cuda-cpp",
          "rust"
        ],
        "configurationAttributes": {
          "launch": {
            "required": [
              "program"
            ],
            "properties": {
              "program": {
                "type": "string",
                "description": "Binary to debug. Only required for 'gdb' mode."
              },
              "stopOnEntry": {
                "type": "boolean",
                "description": "Set breakpoint on main",
                "default": true
              },
              "trace": {
                "type": [
                  "string"
                ],
                "description": "Debug trace logging",
                "enum": [
                  "Off",
                  "GDB Events",
                  "Python logs",
                  "Full"
                ],
                "default": "Off",
                "enumDescriptions": [
                  "Turn all logging off",
                  "Turn trace logging of GDB events on",
                  "Turn debug logging of from Python on",
                  "Turn on additional debug logging to time.log and update.log, made by Python scripts"
                ]
              },
              "args": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Command line arguments passed to debuggee program",
                "default": []
              },
              "allStopMode": {
                "type": "boolean",
                "description": "Whether or not GDB should run in all stop mode",
                "default": true
              },
              "gdbPath": {
                "type": "string",
                "description": "Path to GDB. Defaults to trying to execute GDB in $PATH",
                "default": "gdb"
              },
              "gdbOptions": {
                "type": "array",
                "description": "GDB Arguments."
              },
              "cwd": {
                "type": "string",
                "description": "Current working directory of GDB",
                "default": "${workspaceFolder}"
              },
              "setupCommands": {
                "type": "array",
                "description": "GDB Commands to run before debugging."
              },
              "attachOnFork": {
                "type": "boolean",
                "description": "Whether or not GDB should attach on fork, for instance if you're debugging a target that spawns new processes with `fork`"
              },
              "externalConsole": {
                "type": "object",
                "default": {
                  "path": "",
                  "closeTerminalOnEndOfSession": true,
                  "endSessionOnTerminalExit": true
                },
                "description": "External console settings",
                "required": [
                  "path"
                ],
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "Path to terminal to launch. If it exists in $PATH only the command name has to be provided",
                    "default": ""
                  },
                  "closeTerminalOnEndOfSession": {
                    "type": "boolean",
                    "default": true,
                    "description": "Attempt to close terminal at the end of debug session"
                  },
                  "endSessionOnTerminalExit": {
                    "type": "boolean",
                    "default": true,
                    "description": "End debug session if external console exits"
                  }
                }
              }
            }
          },
          "attach": {
            "properties": {
              "pid": {
                "type": "string",
                "description": "Pid of the process to attach to. ${command:getPid} provides the user with an input box where the user types the process name. If multiple processes with that name exists a drop down list of PIDs to choose from will be displayed",
                "default": "${command:getPid}"
              },
              "program": {
                "type": "string",
                "description": "Binary to debug. Only required for 'gdb' mode. Used for symbolication when attaching to running process."
              },
              "trace": {
                "type": [
                  "string"
                ],
                "description": "Debug trace logging",
                "enum": [
                  "Off",
                  "GDB Events",
                  "Python logs",
                  "Full"
                ],
                "default": "Off",
                "enumDescriptions": [
                  "Turn all logging off",
                  "Turn trace logging of GDB events on",
                  "Turn debug logging of from Python on",
                  "Turn on additional debug logging to time.log and update.log, made by Python scripts"
                ]
              },
              "setupCommands": {
                "type": "array",
                "description": "GDB Commands to run before debugging."
              },
              "cwd": {
                "type": "string",
                "description": "Current working directory of GDB",
                "default": "${workspaceFolder}"
              },
              "gdbPath": {
                "type": "string",
                "description": "Path to GDB. Defaults to trying to execute GDB in $PATH",
                "default": "gdb"
              },
              "gdbOptions": {
                "type": "array",
                "description": "GDB Arguments."
              },
              "attachOnFork": {
                "type": "boolean",
                "description": "Whether or not GDB should attach on fork, for instance if you're debugging a target that spawns new processes with `fork`"
              }
            }
          }
        },
        "initialConfigurations": [
          {
            "type": "midas-gdb",
            "request": "launch",
            "name": "Midas Launch",
            "program": "${workspaceFolder}/program",
            "stopOnEntry": true,
            "trace": "Off",
            "allStopMode": true,
            "cwd": "${workspaceFolder}",
            "setupCommands": []
          },
          {
            "type": "midas-gdb",
            "request": "attach",
            "name": "Midas Attach",
            "program": "${1:program}",
            "pid": "${command:getPid}",
            "trace": "Off",
            "cwd": "${workspaceFolder}",
            "setupCommands": []
          }
        ],
        "configurationSnippets": [
          {
            "name": "midas-gdb",
            "label": "Midas GDB: Launch",
            "description": "Launch midas debugging session for binary selected by user",
            "body": {
              "type": "midas-gdb",
              "request": "launch",
              "name": "${1:Launch Debug}",
              "program": "${2:/path/to/binary}",
              "cwd": "^\"\\${workspaceFolder}\"",
              "stopOnEntry": true,
              "trace": "${3:Off}",
              "gdbPath": "${4:gdb}",
              "allStopMode": true,
              "setupCommands": [],
              "attachOnFork": false
            }
          },
          {
            "name": "midas-gdb",
            "label": "Midas GDB: Attach",
            "description": "Attach GDB to a running process",
            "body": {
              "type": "midas-gdb",
              "request": "attach",
              "name": "${1:Attach to process}",
              "program": "^\"\\${workspaceFolder}\"",
              "cwd": "^\"\\${workspaceFolder}\"",
              "trace": "${4:Off}",
              "pid": "^\"\\${command:getPid}\"",
              "gdbPath": "${5:gdb}",
              "setupCommands": [],
              "attachOnFork": false
            }
          }
        ],
        "variables": {
          "getPid": "midas.getPid"
        }
      },
      {
        "type": "midas-rr",
        "label": "C/C++ Midas rr",
        "languages": [
          "c",
          "cpp",
          "cuda-cpp",
          "rust"
        ],
        "configurationAttributes": {
          "required": [
            "serverAddress"
          ],
          "launch": {
            "properties": {
              "program": {
                "type": "string",
                "description": "Binary to debug. Only required for 'gdb' mode."
              },
              "trace": {
                "type": [
                  "string"
                ],
                "description": "Debug trace logging",
                "enum": [
                  "Off",
                  "GDB Events",
                  "Python logs",
                  "Full"
                ],
                "default": "Off",
                "enumDescriptions": [
                  "Turn all logging off",
                  "Turn trace logging of GDB events on",
                  "Turn debug logging of from Python on",
                  "Turn on additional debug logging to time.log and update.log, made by Python scripts"
                ]
              },
              "gdbPath": {
                "type": "string",
                "description": "Path to GDB. Defaults to trying to execute GDB in $PATH",
                "default": "gdb"
              },
              "gdbOptions": {
                "type": "array",
                "description": "GDB Arguments."
              },
              "cwd": {
                "type": "string",
                "description": "Current working directory of GDB",
                "default": "${workspaceFolder}"
              },
              "rrPath": {
                "type": "string",
                "description": "Path to rr. Defaults to trying to execute rr in $PATH",
                "default": "rr"
              },
              "traceWorkspace": {
                "type": "string",
                "description": "trace workspace. Can be found running the rr command `rr ls`. If not set, user will be prompted for."
              },
              "serverAddress": {
                "type": "string",
                "description": "Connection string to GDB server that rr spawns. Format is host:port",
                "default": "127.0.0.1:50505"
              },
              "setupCommands": {
                "type": "array",
                "description": "GDB Commands to run before debugging."
              },
              "stopOnEntry": {
                "type": "boolean",
                "description": "Set breakpoint on main",
                "default": false
              },
              "externalConsole": {
                "type": "object",
                "default": {
                  "path": "",
                  "closeTerminalOnEndOfSession": true
                },
                "description": "External console settings",
                "required": [
                  "path"
                ],
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "Path to terminal to launch. If it exists in $PATH only the command name has to be provided",
                    "default": ""
                  },
                  "closeTerminalOnEndOfSession": {
                    "type": "boolean",
                    "default": true,
                    "description": "Attempt to close terminal at the end of debug session"
                  }
                }
              }
            }
          }
        },
        "initialConfigurations": [
          {
            "type": "midas-rr",
            "request": "launch",
            "name": "Launch replay session",
            "trace": "Off",
            "cwd": "${workspaceFolder}",
            "serverAddress": "localhost:50505",
            "setupCommands": []
          }
        ],
        "configurationSnippets": [
          {
            "name": "midas-rr",
            "label": "Midas rr debug session",
            "description": "Launches an RR debugging session",
            "body": {
              "type": "midas-rr",
              "request": "launch",
              "name": "${1:Launch replay debug session}",
              "cwd": "^\"\\${workspaceFolder}\"",
              "trace": "${3:Off}",
              "gdbPath": "${4:gdb}",
              "rrPath": "rr",
              "setupCommands": []
            }
          }
        ]
      }
    ]
  },
  "scripts": {
    "lint": "eslint .",
    "pretest": "npm run lint",
    "test": "node ./test/runTest.js",
    "package": "vsce package --yarn"
  },
  "devDependencies": {
    "@babel/cli": "^7.19.3",
    "@babel/core": "^7.20.5",
    "@babel/eslint-parser": "^7.19.1",
    "@babel/preset-env": "^7.20.2",
    "@types/glob": "^8.0.0",
    "@types/mocha": "^10.0.1",
    "@types/node": "^18.11.15",
    "@types/vscode": "^1.74.0",
    "@vscode/debugadapter": "^1.58.0",
    "@vscode/debugadapter-testsupport": "^1.58.0",
    "@vscode/test-electron": "^2.2.1",
    "eslint": "^8.29.0",
    "glob": "^8.0.3",
    "mocha": "^10.2.0",
    "typescript": "^4.9.4"
  },
  "author": {
    "name": "Andreas Farre",
    "email": "andreas@farre.se"
  },
  "maintainers": [
    {
      "name": "Andreas Farre",
      "email": "andreas@farre.se"
    },
    {
      "name": "Simon Farre",
      "email": "simon.farre.cx@gmail.com"
    }
  ],
  "dependencies": {
    "@vscode/codicons": "^0.0.32",
    "@vscode/debugadapter": "^1.58.0",
    "await-notify": "^1.0.1",
    "gdb-js": "^1.3.0",
    "regenerator-runtime": "^0.13.11"
  }
}
